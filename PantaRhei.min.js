// Generated by CoffeeScript 1.3.3
/* 
	PantaRhei.js v 0.0.1
	
	(c) 2012 Federico Weber
	distributed under the MIT license.
	federicoweber](http://federicoweber.com)
*/(function(){var e,t,n,r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};a=this,s={},typeof exports!="undefined"&&exports!==null&&(s=exports,l=require("underscore"),e=require("backbone")),a.Backbone!=null&&(e=a.Backbone,l=a._);if(e===void 0)throw"Please import Backbone to use this library";a.PantaRhei=s,o=s.VERSION="0.0.1",t=s.Flow=function(){function e(e,t){return this.id=e!=null?e:l.uniqueId("flow_"),this.queue=t!=null?t:new Array,this._currentWorker={},this}return e.prototype.use=function(e){if(!l.isFunction(e.run)&&!l.isFunction(e))throw new Error("Provide a proper worker");return this.queue.push(e),this},e.prototype.run=function(e){this.shared=e!=null?e:{};if(this.queue.length===0)throw new Error("The workers queue is empty");return this._paused=!1,this._runningQueue=l.clone(this.queue),this._runningQueue.reverse(),this.trigger("run",this.shared),this._next(),this},e.prototype.pause=function(){return this._paused=!0,this.trigger("pause",this.shared),this},e.prototype.resume=function(){return this._paused=!1,this.trigger("resume",this.shared),this._next(),this},e.prototype.kill=function(){return this},e.prototype._next=function(e){var t;this._currentWorker&&l.isFunction(this._currentWorker.kill)&&this._currentWorker.kill();if(e)return this.pause(),this.trigger("error",e);if(this._runningQueue.length>0){this._currentWorker=this._runningQueue.pop();if(this._currentWorker&&l.isFunction(this._currentWorker.run))return t=l.bind(this._next,this),this._currentWorker.run(this.shared,t);if(this._currentWorker&&l.isFunction(this._currentWorker))return t=l.bind(this._next,this),this._currentWorker(this.shared,t);throw new Error("The "+this._currentWorker.id+" worker does not provide a run method")}return this.trigger("complete",this.shared)},e}(),l.extend(t.prototype,e.Events),u=s.Worker=function(){function e(e){this.id=e!=null?e:l.uniqueId("worker_")}return e.prototype.run=function(e,t){return this.shared=e,this.next=t,this.next(new Error("run must be overridden"))},e.prototype.kill=function(){throw new ReferenceError("kill must be overridden ")},e}(),l.extend(u.prototype,e.Events),t.extend=u.extend=e.View.extend,f=s.workers={},n=f.Iddle=function(e){function t(e,t){this.duration=e,this.id=t!=null?t:l.uniqueId("iddle_")}return h(t,e),t.prototype.run=function(e,t){var n;return this.shared=e,this.next=t,n=function(){return this.next()},setTimeout(n,this.duration),this},t.prototype.kill=function(){return null},t}(u),r=f.JsonLoader=function(e){function t(e,t){this.jsonUrl=e,this.id=t!=null?t:l.uniqueId("jsonLoader_")}return h(t,e),t.prototype.run=function(e,t){var n;return this.shared=e,this.next=t,n=this,this.jsonUrl!=null?$.getJSON(this.jsonUrl,function(){}).success(function(e,t,r){return n.shared.jsonData||(n.shared.jsonData=new Array),n.shared.jsonData[n.id]=e,n.next()}).error(function(e,t,r){return n.shared.loadedData=null,n.shared.errorThrown=r,n.shared.XMLHttpRequest=e,n.next(new Error(t))}):t(new Error("Please provide an url"))},t.prototype.kill=function(){},t}(u),i=f.LoadAssets=function(e){function t(e,t){this.assets=e,this.id=t!=null?t:l.uniqueId("assetsLoader_")}return h(t,e),t.prototype.run=function(e,t){var n,r,i,s,o;return this.shared=e,this.next=t,s=this,l.isArray(this.assets)?(o=this.assets.length,n=0,r=function(){return s.next(new Error("Error loading the asset"))},i=function(){n+=1;if(n===o)return s.shared.assetsPreloaded=!0,s.next()},l.each(this.assets,function(e){var t;return t=new Image,t.onload=i,t.onerror=r,t.src=e})):t(new Error("Please provide some assets"))},t.prototype.kill=function(){},t}(u)}).call(this);