// Generated by CoffeeScript 1.3.3
/* 
	PantaRhei.js v 0.0.1
	
	(c) 2012 Federico Weber
	distributed under the MIT license.
	federicoweber](http://federicoweber.com)
*/(function(){var e,t,n,r,i,s,o;s=this,n={},typeof exports!="undefined"&&exports!==null&&(n=exports,o=require("underscore"),e=require("backbone")),s.Backbone!=null&&(e=s.Backbone,o=s._);if(e===void 0)throw"Please import Backbone to use this library";s.PantaRhei=n,r=n.VERSION="0.0.1",t=n.Flow=function(){function e(e,t){return this.id=e!=null?e:o.uniqueId("flow_"),this._queue=t!=null?t:new Array,this._currentWorker={},this}return e.prototype.use=function(e){if(o.isFunction(e.run)||o.isFunction(e))return this._queue.push(e);throw new Error("Provide a proper worker")},e.prototype.run=function(e){this.shared=e!=null?e:{};if(this._queue.length===0)throw new Error("The workers queue is empty");return this._paused=!1,this._queue.reverse(),this.trigger("run",this.shared),this._next(),this},e.prototype.pause=function(){return this._paused=!0,this.trigger("pause",this.shared),this},e.prototype.resume=function(){return this._paused=!1,this.trigger("resume",this.shared),this._next(),this},e.prototype.kill=function(){return this},e.prototype._next=function(e){var t;this._currentWorker&&o.isFunction(this._currentWorker.kill)&&this._currentWorker.kill();if(e)return this.pause(),this.trigger("error",e);if(this._queue.length>0){this._currentWorker=this._queue.pop();if(this._currentWorker&&o.isFunction(this._currentWorker.run))return t=o.bind(this._next,this),this._currentWorker.run(e,this.shared,t);if(this._currentWorker&&o.isFunction(this._currentWorker))return t=o.bind(this._next,this),this._currentWorker(e,this.shared,t);throw new Error("The "+this._currentWorker.id+" worker does not provide a run method")}return this.trigger("complete",this.shared)},e}(),o.extend(t.prototype,e.Events),i=n.Worker=function(){function e(e){this.id=e!=null?e:o.uniqueId("worker_")}return e.prototype.run=function(e,t){return this.shared=e,this.next=t,this.next(new Error("run must be overridden"))},e.prototype.kill=function(){throw new ReferenceError("kill must be overridden ")},e}(),o.extend(i.prototype,e.Events),t.extend=i.extend=e.View.extend}).call(this);