<!DOCTYPE html>  <html> <head>   <title>PantaRhei.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               PantaRhei.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2> </h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">PantaRhei</span><span class="p">.</span><span class="nx">js</span> <span class="nx">v</span> <span class="mf">0.2</span><span class="p">.</span><span class="mi">0</span>
  
  <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="mi">2012</span> <span class="nx">Federico</span> <span class="nx">Weber</span>
  <span class="nx">distributed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">MIT</span> <span class="nx">license</span><span class="p">.</span>
  <span class="nx">federicoweber</span><span class="p">](</span><span class="nx">http</span><span class="o">://</span><span class="nx">federicoweber</span><span class="p">.</span><span class="nx">com</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>save a reference to the global object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root = </span><span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Define the top-level namespace</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">PantaRhei = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>require underscore and backbone for testing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">exports</span><span class="o">?</span><span class="p">)</span>
  <span class="nv">PantaRhei = </span><span class="nx">exports</span><span class="p">;</span>
  <span class="nv">_ = </span><span class="nx">require</span> <span class="s">&#39;underscore&#39;</span>
  <span class="nv">Backbone = </span><span class="nx">require</span> <span class="s">&#39;backbone&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>check for backbone existence in the browser</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">?</span>
  <span class="nv">Backbone = </span><span class="nx">root</span><span class="p">.</span><span class="nx">Backbone</span>
  <span class="nv">_ = </span><span class="nx">root</span><span class="p">.</span><span class="nx">_</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if backbone is missing throw an error</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nx">Backbone</span> <span class="o">is</span> <span class="kc">undefined</span>
  <span class="k">throw</span> <span class="s">&quot;Please import Backbone to use this library&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Nest top-level namespace into Backbone</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root.PantaRhei = </span><span class="nx">PantaRhei</span>
<span class="nv">VERSION = PantaRhei.VERSION = </span><span class="s">&quot;0.2.0&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Flow</h2>

<p>The purpose of a <strong>Flow</strong> is to ease the declaration and execution 
of a chain of consecutive tasks. Like preparing the data for a new page.</p>

<p>The Flow will take care of extecuting the various
workers in the given order.</p>

<p>It is possible to directly pass to the constructor the queue
If the id is not provided it will generate an uniq one</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Flow = </span><span class="k">class</span> <span class="nx">PantaRhei</span><span class="p">.</span><span class="nx">Flow</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="vi">@id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;flow_&#39;</span><span class="p">),</span> <span class="vi">@queue = </span><span class="k">new</span> <span class="nb">Array</span><span class="p">())</span> <span class="o">-&gt;</span>
    <span class="vi">@_currentWorker = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>assign an uniq name ad id to the workers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_naming</span> <span class="nx">worker</span> <span class="k">for</span> <span class="nx">worker</span> <span class="k">in</span> <span class="nx">@queue</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Methods</h3>

<h4>use</h4>

<p>This method is used to append a new worker in the queue 
it will throw an error if the worker is noth properly structured</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">use: </span><span class="nf">(worker) -&gt;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">worker</span><span class="p">.</span><span class="nx">run</span><span class="p">)</span> <span class="o">or</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">worker</span><span class="p">)</span>
      <span class="nx">@_cacheFlow</span> <span class="nx">worker</span>
      <span class="nx">@_naming</span> <span class="nx">worker</span>
      <span class="nx">@queue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">worker</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Provide a proper worker&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>check</h3>

<p>This is used to add a test worker on the queue.
It will test the provides key and value pairs against the shared object.
If the test do faile the flow will be interrupted.
As sole parameter it accept an object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">check: </span><span class="nf">(valuesToTest)-&gt;</span>
    <span class="nv">worker = </span><span class="k">new</span> <span class="nx">ValueChecker</span><span class="p">(</span><span class="nx">valuesToTest</span><span class="p">)</span>
    <span class="nx">@_cacheFlow</span> <span class="nx">worker</span>
    <span class="nx">@_naming</span> <span class="nx">worker</span>
    <span class="nx">@queue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">worker</span>
    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>run</h3>

<p>This is the method used to actually run the flow
if the @shared object is not provided it create an empty one</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">run: </span><span class="nf">(@shared = {}) -&gt;</span>
    <span class="k">if</span> <span class="nx">@queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;The workers queue is empty&quot;</span>
    <span class="k">else</span>
      <span class="vi">@_paused = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>create a running copy of the queue. This is usefull to allow multiple consecutive run.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@_runningQueue = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">@queue</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>reverse the queueu to run everthing int the proper order</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_runningQueue</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>fire the run event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;run&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>run the first worker</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_next</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h4>Pause</h4>

<p>Simply pause the flow</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pause: </span><span class="o">-&gt;</span>
    <span class="vi">@_paused = </span><span class="kc">true</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;pause&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h4>Resume</h4>

<p>Resume a paused Flow</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resume: </span><span class="o">-&gt;</span>
    <span class="vi">@_paused = </span><span class="kc">false</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;resume&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">)</span>
    <span class="nx">@_next</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h4>Terminate</h4>

<p>This is used to interrupt the flow at will; it will empty the running queue and throw a <strong>terminate</strong> and a <strong>done</strong> event.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">terminate: </span><span class="o">-&gt;</span>
    <span class="vi">@_runningQueue = </span><span class="p">[]</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;terminate&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">)</span>
    <span class="nx">@_next</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>return the Flow to enable cascade coding</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>kill: ->
    # return the Flow to enable cascade coding
    return this</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h4>_cacheFlow</h4>

<p>this is an internal function to store a reference to the flow into the worker</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_cacheFlow: </span><span class="nf">(worker) -&gt;</span>
    <span class="nv">worker._flow = </span><span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h4>_naming</h4>

<p>this is an internal function to an name and an id to the worker to ease debugging
the given name is equal to the worker id</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_naming: </span><span class="nf">(worker) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>add the id if it's not provided</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">worker</span><span class="p">.</span><span class="nx">id</span><span class="o">?</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">uniqId</span><span class="o">?</span>
        <span class="nv">uniqId = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;worker_&#39;</span><span class="p">)</span>
      <span class="nv">worker.id = </span><span class="nx">uniqId</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h4>_next</h4>

<p>this private method is used to actually run the worker 
it's also passed as the <strong>next</strong> callback to each worker</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_next: </span><span class="nf">(error) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>if an error is passed in fire the error event and pause the flow</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">error</span>
      <span class="nx">@pause</span><span class="p">()</span>
      <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>kill the previous worker</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@_currentWorker</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">kill</span>
        <span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">kill</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>run the worker queue</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@_runningQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="vi">@_currentWorker = </span><span class="nx">@_runningQueue</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>run the worker if it provide the run method</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@_currentWorker</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">run</span>
          <span class="nv">cNext = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@_next</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
          <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">,</span> <span class="nx">@_currentWorker</span><span class="p">)</span>
          <span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">@shared</span><span class="p">,</span> <span class="nx">cNext</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>run the worker if it's a function</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="nx">@_currentWorker</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@_currentWorker</span>
          <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">,</span> <span class="nx">@_currentWorker</span><span class="p">)</span>
          <span class="nv">cNext = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@_next</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
          <span class="nx">@_currentWorker</span><span class="p">(</span><span class="nx">@shared</span><span class="p">,</span> <span class="nx">cNext</span><span class="p">)</span>

        <span class="k">else</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;The </span><span class="si">#{</span><span class="nx">@_currentWorker</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s"> cannot be executed&quot;</span>
      </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>fire the <strong>complete</strong> event if the queue have been succesfully runned</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>TODO: set the app as notBusy</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;complete&#39;</span><span class="p">,</span> <span class="nx">@shared</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>enable events for the Flow</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h2>Worker</h2>

<p>define the Worker </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Worker = </span><span class="k">class</span> <span class="nx">PantaRhei</span><span class="p">.</span><span class="nx">Worker</span>

  <span class="nv">constructor: </span><span class="p">(</span><span class="vi">@id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;worker_&#39;</span><span class="p">))</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h3>Attributes</h3>

<h4>_flow</h4>

<p>This is a cached reference to the flow to which the worker belong and it's setted by the Flow</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_flow: </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <h3>Methods</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h4>run</h4>

<p>Used by the flow to execute the worker.
It's meant to be overridden, if not it will pass an error to the flow
It accept the following mandatory arguments:</p>

<ul>
<li><strong>shared</strong> object, which purpose is to act as a vehicle of data among the various worker;</li>
<li><strong>next</strong> to call next step of the flow</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">run: </span><span class="nf">(@shared, @next) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>run the next worker</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@next</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&#39;run must be overridden&#39;</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h4>kill</h4>

<p>This is runned by the Flow before running the next worker
It's meant to be overridden, if not it will throw an error</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">kill: </span><span class="o">-&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">ReferenceError</span> <span class="s">&quot;kill must be overridden &quot;</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Worker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <h3>Value Checker</h3>

<p>This is a special worker that is automatically created by the Flow.check method.
The only required attribute is @valuesToTest object that contains all the key value pairs to test.
If any of the test fail the worker will interrupt the flow</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ValueChecker</span> <span class="k">extends</span> <span class="nx">Worker</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="nx">@valuesToTest</span><span class="p">,</span> <span class="vi">@id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;valueChecker_&#39;</span><span class="p">))</span> <span class="o">-&gt;</span>
  <span class="nv">run: </span><span class="nf">(shared, next) -&gt;</span>
    <span class="nv">checkValues = </span><span class="nx">_</span><span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="nx">@valuesToTest</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">pairs</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">map</span><span class="p">(</span>
        <span class="nf">(el)-&gt;</span>
          <span class="k">if</span> <span class="nx">shared</span><span class="p">[</span><span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">is</span> <span class="nx">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">value</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">checkValues</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">@_flow</span><span class="p">.</span><span class="nx">terminate</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">next</span><span class="p">()</span>

  <span class="nv">kill: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <hr />

<p>Borrowed the Backbone style extend</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Flow.extend = Worker.extend = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 